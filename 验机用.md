# 验机

[TOC]

## 账号信息

一般演示账号

+ 用户名 `hurui`
+ 密码 `passw0rd`

已上传MNIST数据集的账号

+ 用户名 `user`
+ 密码 `user`

管理员密钥

`0497F52352F21586AC1EA3DFFBF76FCD73B4850F93DE01449738B80A064C8038`

## 演示内容

拉起Docker，不拉起后端，演示用户登录失败的提示。

拉起后端，演示密码错误等提示。

正常登录一般演示账号，操作：

+ 查询用户信息
+ 上传图片、查看图片、修改图片、删除图片、图片过滤器
+ 讲解图片在后端的存储格式，存储系统的文件路径
+ 查看正常训练的模型详情、查看出错的模型训练详情、使用模型推理、删除模型、模型过滤器
+ 查看原型，讲解原型的可拓展性（代码、接口）

退出账号，登录已上传MNIST数据集的账号。

拉起Worker，演示创建模型。

讲解模型训练流程：

1. 用户发起创建模型请求，后端记录，初始状态为`INITIALIZING`
2. 后端线程扫描数据库（`INITIALIZING`），发现该任务，为该任务生成训练用数据（数据集打包），完成后更新为`DISTRIBUTING`状态，出错则更新为`ERROR`状态
3. 后端线程扫描数据库（`DISTRIBUTING`），发现该任务，将该任务通过Redis发布给在线的Worker
4. Worker收到任务，以任务ID和固定前缀为key竞争锁，唯一竞争到锁的Worker开始准备训练该模型，其他Worker放弃，并等待下一个任务
5. 后端线程扫描数据库（`DISTRIBUTING`），发现该任务，若该任务在Redis中的训练锁有效，更新为`TRAINING`
6. 后端线程扫描数据库（`TRAINING`），若发现该任务对应的训练锁失效，则更新为`ERROR`，表明训练线程崩溃，没有及时刷新训练锁
7. Worker训练完成，将结果写入存储系统后，将结果（测试集）通过Redis回报给后端，后端将任务状态更新为`FINISHED`（顺利完成）或`ERROR`（训练出错）

对应后台日志输出和任务状态变化讲解。

训练完成后演示推理。

退出，登录管理员账号。

演示管理员功能，讲解管理员接口的鉴权。

代码、接口讲解。

